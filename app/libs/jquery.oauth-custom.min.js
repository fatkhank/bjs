var jqOAuth=function(n){this.options={store:null};this.data={};this.intercept=!1;this.refreshing=!1;this.buffer=[];this.currentRequests=[];this._resetOptions();this._setupInterceptor();$.extend(this.options,n);this._hasStoredData()?(this._getStoredData(),this.hasAccessToken()&&this.login(this.data.accessToken)):(this._resetData(),this._updateStorage());n.csrfToken!==null&&this._setCsrfHeader()};jqOAuth.prototype.getAccessToken=function(){return this.data.accessToken};jqOAuth.prototype.hasAccessToken=function(){return this.data.accessToken!==null};jqOAuth.prototype.logout=function(){this._resetData();this._updateStorage();this._deactivateInterceptor();this._removeAjaxHeader("Authorization");this._fireEvent("logout")};jqOAuth.prototype.login=function(n){this.setAccessToken(n);this._activateInterceptor();this._fireEvent("login")};jqOAuth.prototype.setAccessToken=function(n){this.data.accessToken=n;this._setAuthorizationHeader();this._updateStorage()};jqOAuth.prototype.setCsrfToken=function(n){this.options.csrfToken=n;this._setCsrfHeader()};jqOAuth.prototype._activateInterceptor=function(){this.intercept=!0};jqOAuth.prototype._addToBuffer=function(n,t){this.buffer.push({deferred:t,settings:n})};jqOAuth.prototype._clearBuffer=function(){this.buffer=[]};jqOAuth.prototype._deactivateInterceptor=function(){this.intercept=!1};jqOAuth.prototype._fireBuffer=function(){var t=this,i,r=[];for(var n in this.buffer)i=this.buffer[n].deferred,this.buffer[n].settings.refreshRetry=!0,this.buffer[n].settings.headers.Authorization=$.ajaxSettings.headers.Authorization,r.push($.ajax(this.buffer[n].settings).then(i.resolve,i.reject));this._clearBuffer();$.when.apply($,r).done(function(){t._setRefreshingFlag(!1)}).fail(function(){t._setRefreshingFlag(!1);t.logout()})};jqOAuth.prototype._fireEvent=function(n){if(this._hasEvent(n))return this.options.events[n]()};jqOAuth.prototype._getStoredData=function(){$.extend(this.data,this.options.store.get(this.options.tokenName))};jqOAuth.prototype._hasEvent=function(n){return this.options.events[n]!==undefined&&typeof this.options.events[n]=="function"};jqOAuth.prototype._hasStoredData=function(){return this.options.store.get(this.options.tokenName)!==undefined};jqOAuth.prototype._isAjaxHeadersInitialized=function(){return $.ajaxSettings.headers!==undefined};jqOAuth.prototype._removeAjaxHeader=function(n){if(!this._isAjaxHeadersInitialized())return!0;$.ajaxSettings.headers[n]=undefined};jqOAuth.prototype._removeAllAjaxHeaders=function(){this._removeAjaxHeader("Authorization");this._removeAjaxHeader("X-CSRF-Token")};jqOAuth.prototype._resetData=function(){this.data={accessToken:null}};jqOAuth.prototype._resetOptions=function(){this.options={bufferInterval:25,bufferWaitLimit:500,csrfToken:null,events:{},tokenName:"jquery.oauth"};this._removeAllAjaxHeaders()};jqOAuth.prototype._setAjaxHeader=function(n,t){this._isAjaxHeadersInitialized()||($.ajaxSettings.headers={});$.ajaxSettings.headers[n]=t};jqOAuth.prototype._setAuthorizationHeader=function(){this._setAjaxHeader("Authorization","Bearer "+this.data.accessToken)};jqOAuth.prototype._setCsrfHeader=function(){this._setAjaxHeader("X-CSRF-Token",this.options.csrfToken)};jqOAuth.prototype._setRefreshingFlag=function(n){this.refreshing=n};jqOAuth.prototype._setupInterceptor=function(){var n=this;$.ajaxPrefilter(function(t,i,r){if(t.refreshRetry!==!0){var u=$.Deferred();return n.currentRequests.push(t.url),r.always(function(){n.currentRequests.splice($.inArray(t.url,n.currentRequests),1)}),r.done(u.resolve),r.fail(function(){var i=Array.prototype.slice.call(arguments);n.intercept&&r.status===401&&n._hasEvent("tokenExpiration")?(n._addToBuffer(t,u),n.refreshing||(n._setRefreshingFlag(!0),n._fireEvent("tokenExpiration").then(function(){var t=0;n.interval=setInterval(function(){t+=n.options.bufferInterval;(n.currentRequests.length===0||t>=n.options.bufferWaitLimit)&&(clearInterval(n.interval),n._fireBuffer())},n.options.bufferInterval)},function(){n.logout()}))):u.rejectWith(r,i)}),u.promise(r)}})};jqOAuth.prototype._updateStorage=function(){this.options.store.set(this.options.tokenName,this.data)};
//# sourceMappingURL=jquery.oauth-custom.min.js.map
